<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar">
  <h2>ADMIN</h2>
  <nav>
    <button onclick="openPage('overview')">Overview</button>
    <button onclick="openPage('users')">Users</button>
    <button onclick="openPage('products')">Products</button>
    <button onclick="openPage('orders')">Orders</button>
    <button onclick="openPage('categories')">Categories</button>
    <button onclick="openPage('analytics')">Analytics</button>
    <button onclick="openPage('settings')">Settings</button>
    <button class="logout" onclick="logout()">Logout</button>
  </nav>
</aside>

<!-- Main -->
<main class="main">

  <!-- OVERVIEW -->
  <section id="overview" class="page active">
    <h1>Dashboard</h1>
    <div class="cards">
      <div class="card">Users<br><strong>0</strong></div>
      <div class="card">Products<br><strong>0</strong></div>
      <div class="card">Orders<br><strong>0</strong></div>
      <div class="card">Revenue<br><strong>â‚¹0</strong></div>
    </div>
  </section>

  <!-- USERS -->
  <!-- <section id="users" class="page">
    <h1>Users</h1>
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>user@email.com</td>
          <td>Active</td>
          <td>
            <button>Block</button>
            <button>Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </section> -->
  <section id="users" class="page">
  <h1>Users</h1>

  <div class="controls">
    <input
      type="text"
      id="searchInput"
      placeholder="Search by email"
      oninput="loadUsers(1)"
    />

    <select id="statusFilter" onchange="loadUsers(1)">
      <option value="all">All</option>
      <option value="active">Active</option>
      <option value="blocked">Blocked</option>
    </select>
  </div>

  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pagination">
    <button onclick="prevPage()">Prev</button>
    <span id="pageInfo"></span>
    <button onclick="nextPage()">Next</button>
  </div>
</section>


  <!-- PRODUCTS -->
  <section id="products" class="page">
    <h1>Products</h1>
    <button>Add Product</button>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ORDERS -->
  <section id="orders" class="page">
    <h1>Orders</h1>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>User</th>
          <th>Status</th>
          <th>Update</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- CATEGORIES -->
  <section id="categories" class="page">
    <h1>Categories</h1>
    <input placeholder="New category">
    <button>Add</button>
    <ul class="list"></ul>
  </section>

  <!-- ANALYTICS -->
  <section id="analytics" class="page">
    <h1>Analytics</h1>
    <p>Graphs & charts will be added later</p>
  </section>

  <!-- SETTINGS -->
  <section id="settings" class="page">
    <h1>Settings</h1>
    <button>Maintenance Mode</button>
    <button>Manage Admins</button>
  </section>

</main>

<script>


// const API = "https://my-store-w94t.onrender.com/api/admin";
// const token = localStorage.getItem("adminToken");

// if (!token) {
//   window.location.href = "admin-login.html";
// }

// function openPage(pageId) {
//   document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
//   document.getElementById(pageId).classList.add("active");

//   if (pageId === "users") loadUsers();
// }

// function logout() {
//   localStorage.removeItem("adminToken");
//   window.location.href = "admin-login.html";
// }

// /* Load users count */
// async function loadUserCount() {
//   const res = await fetch(`${API}/users/count`, {
//     headers: { Authorization: `Bearer ${token}` }
//   });
//   const data = await res.json();
//   document.querySelector(".card strong").innerText = data.count;
// }

// /* Load users */
// async function loadUsers() {
//   const res = await fetch(`${API}/users`, {
//     headers: { Authorization: `Bearer ${token}` }
//   });
//   const users = await res.json();

//   const tbody = document.querySelector("#users tbody");
//   tbody.innerHTML = "";

//   users.forEach(user => {
//     const tr = document.createElement("tr");
//     tr.innerHTML = `
//       <td>${user.email}</td>
//       <td>${user.isBlocked ? "Blocked" : "Active"}</td>
//       <td>
//         <button onclick="toggleBlock('${user._id}')">
//           ${user.isBlocked ? "Unblock" : "Block"}
//         </button>
//         <button onclick="deleteUser('${user._id}')">Delete</button>
//       </td>
//     `;
//     tbody.appendChild(tr);
//   });
// }

// /* Block / Unblock */
// async function toggleBlock(userId) {
//   await fetch(`${API}/users/${userId}/block`, {
//     method: "PATCH",
//     headers: {
//       Authorization: `Bearer ${token}`
//     }
//   });

//   loadUsers();
//   loadUserCount();
// }

// /* Delete user */
// async function deleteUser(userId) {
//   if (!confirm("Are you sure?")) return;

//   await fetch(`${API}/users/${userId}`, {
//     method: "DELETE",
//     headers: {
//       Authorization: `Bearer ${token}`
//     }
//   });

//   loadUsers();
//   loadUserCount();
// }

// /* Initial load */
// loadUserCount();


const API = "https://my-store-w94t.onrender.com/api/admin";
const token = localStorage.getItem("adminToken");

let currentPage = 1;
let totalPages = 1;

if (!token) {
  window.location.href = "admin-login.html";
}

function openPage(pageId) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(pageId).classList.add("active");

  if (pageId === "users") loadUsers(1);
}

function logout() {
  localStorage.removeItem("adminToken");
  window.location.href = "admin-login.html";
}

  /* Load users count */
async function loadUserCount() {
  const res = await fetch(`${API}/users/count`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const data = await res.json();
  document.querySelector(".card strong").innerText = data.count;
}

/* LOAD USERS */
async function loadUsers(page = 1) {
  currentPage = page;

  const search = document.getElementById("searchInput").value;
  const status = document.getElementById("statusFilter").value;

  const res = await fetch(
    `${API}/users?page=${page}&limit=5&search=${search}&status=${status}`,
    {
      headers: {
        Authorization: `Bearer ${token}`
      }
    }
  );

  const data = await res.json();
  totalPages = data.pages;

  const tbody = document.querySelector("#users tbody");
  tbody.innerHTML = "";

  data.users.forEach(user => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${user.email}</td>
      <td>${user.isBlocked ? "Blocked" : "Active"}</td>
      <td>
        <button onclick="toggleBlock('${user._id}')">
          ${user.isBlocked ? "Unblock" : "Block"}
        </button>
        <button onclick="deleteUser('${user._id}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("pageInfo").innerText =
    `Page ${currentPage} of ${totalPages}`;
}

/* PAGINATION */
function nextPage() {
  if (currentPage < totalPages) loadUsers(currentPage + 1);
}

function prevPage() {
  if (currentPage > 1) loadUsers(currentPage - 1);
}

/* BLOCK / UNBLOCK */
async function toggleBlock(id) {
  await fetch(`${API}/users/${id}/block`, {
    method: "PATCH",
    headers: {
      Authorization: `Bearer ${token}`
    }
  });

  loadUsers(currentPage);
}

/* DELETE USER */
async function deleteUser(id) {
  if (!confirm("Delete this user?")) return;

  await fetch(`${API}/users/${id}`, {
    method: "DELETE",
    headers: {
      Authorization: `Bearer ${token}`
    }
  });

  loadUsers(currentPage);
}

/* Initial load */
loadUserCount();


</script>
</body>
</html>
