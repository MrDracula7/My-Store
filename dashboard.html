<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>

<div class="dashboard">
  <img id="profileImg" class="avatar" />
  <h2 id="name"></h2>
  <p id="email"></p>

  <form id="profileForm">
    <input type="text" id="newName" placeholder="Update name" />
    <input type="file" id="photo" />
    <button type="submit">Update Profile</button>
  </form>

  <button id="logoutBtn" class="logout">Logout</button>
</div>

<script>
const token = localStorage.getItem("token");

if (!token) {
  window.location.href = "login.html";
}
  
  profileImg.src = user.photo || "default-avatar.png";


fetch("https://my-store-w94t.onrender.com/api/dashboard", {
  headers: {
    Authorization: "Bearer " + token
  }
})
.then(res => res.json())
.then(user => {
  document.getElementById("name").innerText = user.name || "No Name";
  document.getElementById("email").innerText = user.email;
  document.getElementById("profilePhoto").src =
    user.photo || "https://via.placeholder.com/90";
});

// Update profile
document.getElementById("profileForm").addEventListener("submit", async e => {
  e.preventDefault();

  const formData = new FormData();
  formData.append("name", document.getElementById("newName").value);
  formData.append("photo", document.getElementById("photo").files[0]);

  const res = await fetch("https://my-store-w94t.onrender.com/api/profile", {
    method: "PUT",
    headers: {
      Authorization: "Bearer " + token
    },
    body: formData
  });

  const updatedUser = await res.json();
  location.reload();
});

// Logout
document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("token");
  window.location.href = "login.html";
};


</script>
</body>
</html>
